<Window x:Class="AccountingSystem.WPF.Views.CashierManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="إدارة الكاشير" 
        Height="700" Width="1200" 
        Style="{StaticResource StandardWindow}"
        WindowState="Maximized">
    
    <Grid Style="{StaticResource MainWindowLayout}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- شريط العنوان -->
        <Border Grid.Row="0" Style="{StaticResource TitleBarLayout}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock Text="{StaticResource CashierIcon}" 
                               FontSize="24" 
                               VerticalAlignment="Center" 
                               Margin="{StaticResource SmallMargin}"/>
                    <TextBlock Text="إدارة الكاشير" 
                               Style="{StaticResource HeaderTextBlock}"
                               Foreground="{StaticResource TextOnPrimaryBrush}"/>
                </StackPanel>
                
                <Button Grid.Column="1" 
                        Name="btnAddCashier"
                        Style="{StaticResource SuccessButton}"
                        Click="btnAddCashier_Click">
                    <StackPanel Orientation="Horizontal">
                        <ContentPresenter Content="{StaticResource AddIcon}" Margin="0,0,5,0"/>
                        <TextBlock Text="إضافة كاشير"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="{StaticResource MasterSurfaceBrush}" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <Grid Grid.Column="0" Height="36">
                    <TextBox Name="txtSearch" 
                             TextChanged="txtSearch_TextChanged"
                             Foreground="{StaticResource TextPrimaryColor}" Padding="10" FontSize="{StaticResource FontSizeNormal}"
                             BorderBrush="{StaticResource BorderColor}" BorderThickness="1"/>
                    <!-- Placeholder بسيط -->
                    <TextBlock IsHitTestVisible="False"
                               Margin="12,0,0,0"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource TextMutedColor}" FontSize="{StaticResource FontSizeSmall}">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text, ElementName=txtSearch}" Value="">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Setter Property="Text" Value="البحث بالاسم، الكود، الهاتف أو البريد الإلكتروني..."/>
                                    </DataTrigger>
                                    <Trigger Property="Visibility" Value="Visible">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Grid>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="15,0,0,0">
                    <Button Name="btnEditCashier" Click="btnEditCashier_Click"
                            Style="{StaticResource WarningButton}"
                            Padding="12,8" Margin="5,0" BorderThickness="0" FontSize="13">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="Black" Width="14" Height="14" Margin="0,0,5,0"
                                  Data="M14.06,9.02L14.98,9.94L5.92,19H5V18.08L14.06,9.02M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z"/>
                            <TextBlock Text="تعديل"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Name="btnDeleteCashier" Click="btnDeleteCashier_Click"
                            Style="{StaticResource DangerButton}"
                            Padding="12,8" Margin="5,0" BorderThickness="0" FontSize="13">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="White" Width="14" Height="14" Margin="0,0,5,0"
                                  Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                            <TextBlock Text="حذف"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Name="btnActivateCashier" Click="btnActivateCashier_Click"
                            Style="{StaticResource InfoButton}"
                            Padding="12,8" Margin="5,0" BorderThickness="0" FontSize="13">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="White" Width="14" Height="14" Margin="0,0,5,0"
                                  Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6Z"/>
                            <TextBlock Text="تفعيل/إلغاء"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Name="btnPermissions" Click="btnPermissions_Click"
                            Style="{StaticResource SecondaryButton}"
                            Padding="12,8" Margin="5,0" BorderThickness="0" FontSize="13">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="White" Width="14" Height="14" Margin="0,0,5,0"
                                  Data="M12,12H19C18.47,16.11 15.72,19.78 12,20.92V12H5V6.3L12,3.19M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7A1.5,1.5 0 0,0 10.5,8.5A1.5,1.5 0 0,0 12,10A1.5,1.5 0 0,0 13.5,8.5A1.5,1.5 0 0,0 12,7Z"/>
                            <TextBlock Text="الصلاحيات"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Name="btnOpenPOS" Click="btnOpenPOS_Click"
                            Style="{StaticResource SuccessButton}"
                            Padding="12,8" Margin="5,0" BorderThickness="0" FontSize="13">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="White" Width="14" Height="14" Margin="0,0,5,0"
                                  Data="M2,3H9L10.5,7H19C19.8,7 20.5,7.67 20.5,8.5C20.5,8.67 20.47,8.84 20.41,9L18.83,15C18.64,15.58 18.11,16 17.5,16H8.5L7.09,18.91C7.05,19.07 6.91,19.18 6.75,19.18H4.5C4.22,19.18 4,18.96 4,18.68V18.32C4,18.04 4.22,17.82 4.5,17.82H6.31L10.46,7.64L8.5,3H2C1.72,3 1.5,2.78 1.5,2.5V2C1.5,1.72 1.72,1.5 2,1.5H8.5C8.78,1.5 9,1.72 9,2V2.5C9,2.78 8.78,3 8.5,3H2Z"/>
                            <TextBlock Text="نقطة البيع"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Name="btnRefresh" Click="btnRefresh_Click"
                            Style="{StaticResource SecondaryButton}"
                            Padding="12,8" Margin="5,0" BorderThickness="0" FontSize="13">
                        <StackPanel Orientation="Horizontal">
                            <Path Fill="White" Width="14" Height="14" Margin="0,0,5,0"
                                  Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                            <TextBlock Text="تحديث"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Data Grid -->
        <Border Grid.Row="2" Background="{StaticResource MasterSurfaceBrush}" Margin="15" CornerRadius="8" 
                BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
            <DataGrid Name="dgCashiers" AutoGenerateColumns="False"
                      HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                      Background="{StaticResource MasterSurfaceBrush}" RowBackground="{StaticResource MasterSurfaceBrush}" 
                      AlternatingRowBackground="{StaticResource BackgroundBrush}"
                      BorderThickness="0" CanUserAddRows="False"
                      FontSize="13" IsReadOnly="True"
                      EnableRowVirtualization="True" EnableColumnVirtualization="True"
                      MouseDoubleClick="dgCashiers_MouseDoubleClick">
                
                <DataGrid.Columns>
                    <DataGridTextColumn Header="كود الكاشير" Width="100" Binding="{Binding CashierCode}"/>
                    <DataGridTextColumn Header="الاسم" Width="150" Binding="{Binding Name}"/>
                    <DataGridTextColumn Header="الهاتف" Width="120" Binding="{Binding Phone}"/>
                    <DataGridTextColumn Header="البريد الإلكتروني" Width="200" Binding="{Binding Email}"/>
                    <DataGridTextColumn Header="تاريخ التوظيف" Width="120" Binding="{Binding HireDate, StringFormat=dd/MM/yyyy}"/>
                    <DataGridTextColumn Header="الراتب" Width="120" Binding="{Binding Salary, StringFormat={}{0:N2} ج.م}"/>
                    <DataGridTextColumn Header="الحالة" Width="100" Binding="{Binding Status}"/>

                    <!-- نشط/غير نشط -->
                    <DataGridTemplateColumn Header="نشط" Width="70">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="10" Width="20" Height="20">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{StaticResource SecondaryLightBrush}"/>
                                            <Setter Property="ToolTip" Value="غير نشط"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                    <Setter Property="Background" Value="{StaticResource SuccessBrush}"/>
                                                    <Setter Property="ToolTip" Value="نشط"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="آخر دخول" Width="160" 
                                        Binding="{Binding LastLoginTime, StringFormat=dd/MM/yyyy HH:mm}"/>

                    <!-- شارات الصلاحيات -->
                    <DataGridTemplateColumn Header="الصلاحيات" Width="220">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Border Background="{StaticResource SuccessBrush}" CornerRadius="3" Padding="4,2" Margin="2"
                                            Visibility="{Binding CanOpenCashDrawer, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBlock Text="خزينة" Foreground="{StaticResource TextOnPrimaryColor}" FontSize="{StaticResource FontSizeXSmall}"/>
                                    </Border>
                                    <Border Background="{StaticResource InfoBrush}" CornerRadius="3" Padding="4,2" Margin="2"
                                            Visibility="{Binding CanApplyDiscounts, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBlock Text="خصم" Foreground="{StaticResource TextOnPrimaryColor}" FontSize="{StaticResource FontSizeXSmall}"/>
                                    </Border>
                                    <Border Background="{StaticResource WarningBrush}" CornerRadius="3" Padding="4,2" Margin="2"
                                            Visibility="{Binding CanProcessReturns, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBlock Text="مرتجع" Foreground="{StaticResource TextPrimaryColor}" FontSize="{StaticResource FontSizeXSmall}"/>
                                    </Border>
                                    <Border Background="{StaticResource PrimaryBrush}" CornerRadius="3" Padding="4,2" Margin="2"
                                            Visibility="{Binding CanViewReports, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBlock Text="تقارير" Foreground="{StaticResource TextOnPrimaryColor}" FontSize="{StaticResource FontSizeXSmall}"/>
                                    </Border>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>
</Window>
