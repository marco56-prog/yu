<Window x:Class="AccountingSystem.WPF.Views.ModernItemEntryDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ø¥Ø¯Ø®Ø§Ù„/ØªØ¹Ø¯ÙŠÙ„ ØµÙ†Ù Ø§Ø­ØªØ±Ø§ÙÙŠ"
        Height="580" Width="900" MinHeight="520" MinWidth="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        FlowDirection="RightToLeft"
        FontFamily="Segoe UI, Tahoma"
        FontSize="{DynamicResource FontSizeSmall}"
        Background="{DynamicResource BackgroundBrush}"
        PreviewKeyDown="Window_PreviewKeyDown"
        Loaded="Window_Loaded"
        FocusManager.FocusedElement="{Binding ElementName=cmbProduct}">

    <!-- ================= Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ ================= -->
    <Window.InputBindings>
        <KeyBinding Key="F1" Command="{Binding SearchProductCommand}"/>
        <KeyBinding Key="F5" Command="{Binding PreviousItemCommand}"/>
        <KeyBinding Key="F6" Command="{Binding NextItemCommand}"/>
        <KeyBinding Modifiers="Control" Key="S" Command="{Binding SaveAndAddCommand}"/>
        <KeyBinding Modifiers="Control+Shift" Key="S" Command="{Binding SaveAndCloseCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CancelCommand}"/>
        <KeyBinding Key="Enter" Command="{Binding SmartEnterCommand}"/>
    </Window.InputBindings>

    <!-- ================= Ù…ÙˆØ§Ø±Ø¯ Ù…Ø­Ù„ÙŠØ© ÙˆØ£Ù†Ù…Ø§Ø· ================= -->
    <Window.Resources>
        
        <!-- Ø£Ù†Ù…Ø§Ø· Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠØ© -->
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="{DynamicResource FontSizeNormal}"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryBrush}"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>

        <Style x:Key="SmartTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="32"/>
            <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </Trigger>
                <Trigger Property="IsReadOnly" Value="True">
                    <Setter Property="Background" Value="{DynamicResource DisabledBrush}"/>
                    <Setter Property="Foreground" Value="{DynamicResource MutedBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="NumericTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource SmartTextBoxStyle}">
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="SmartComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Height" Value="32"/>
            <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Background" Value="{DynamicResource SurfaceBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Ø´Ø§Ø±Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
        <Style x:Key="InfoBadge" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Background" Value="{DynamicResource InfoBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource InfoBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- ØªØ­Ø°ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
        <Style x:Key="StockWarningStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="6,3"/>
            <Setter Property="Background" Value="{DynamicResource DangerBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource DangerBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Opacity" Value="0.9"/>
        </Style>

        <!-- ØªÙ„Ù…ÙŠØ­ Ø³Ø±ÙŠØ¹ -->
        <Style x:Key="QuickHint" TargetType="TextBlock">
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="Foreground" Value="{DynamicResource MutedBrush}"/>
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­Ø§Ù„Ø© -->
        <Style x:Key="StatusIcon" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
        </Style>

        <!-- ØªØ­ÙˆÙŠÙ„Ø© ÙˆØ­Ø¯Ø© Ù…Ø¹Ù‚Ø¯Ø© -->
        <DataTemplate x:Key="UnitConversionTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding UnitName}" FontWeight="Bold"/>
                <TextBlock Text=" (1 = " Margin="4,0,0,0"/>
                <TextBlock Text="{Binding ConversionFactor}"/>
                <TextBlock Text=" Ù…Ù† Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©)" Margin="0,0,4,0"/>
            </StackPanel>
        </DataTemplate>

    </Window.Resources>

    <!-- ================= ØªØ®Ø·ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ================= -->
    <Grid Margin="16" Background="{DynamicResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ========== Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø­Ø§Ù„Ø© ========== -->
        <Border Grid.Row="0" 
                Background="{DynamicResource PrimaryBrush}" 
                CornerRadius="8,8,0,0" 
                Padding="16,12" 
                Margin="0,0,0,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" 
                           Text="Ø¥Ø¯Ø®Ø§Ù„ ØµÙ†Ù Ø°ÙƒÙŠ" 
                           FontSize="{DynamicResource FontSizeLarge}" 
                           FontWeight="Bold" 
                           Foreground="White" 
                           VerticalAlignment="Center"/>

                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,16,0">
                    <TextBlock Text="Ø§Ù„Ù…ØªØ§Ø­:" Foreground="White" Margin="0,0,4,0"/>
                    <Border Background="White" 
                            CornerRadius="4" 
                            Padding="6,2">
                        <TextBlock x:Name="lblAvailableStock" 
                                   Text="0.00" 
                                   FontWeight="Bold" 
                                   Foreground="{DynamicResource AccentBrush}"/>
                    </Border>
                </StackPanel>

                <!-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ -->
                <Border Grid.Column="2" 
                        x:Name="brdValidationStatus"
                        Background="{DynamicResource SuccessBrush}" 
                        CornerRadius="20" 
                        Width="40" Height="40" 
                        VerticalAlignment="Center">
                    <TextBlock x:Name="lblValidationIcon" 
                               Text="âœ“" 
                               Style="{StaticResource StatusIcon}" 
                               Foreground="White"/>
                </Border>
            </Grid>
        </Border>

        <!-- ========== Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ========== -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù†: Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„ÙˆØ­Ø¯Ø© ÙˆØ§Ù„ÙƒÙ…ÙŠØ§Øª -->
                <StackPanel Grid.Column="0">
                    
                    <!-- Ø§Ù„Ù…Ù†ØªØ¬ + Ø¨Ø­Ø« -->
                    <TextBlock Text="Ø§Ù„Ù…Ù†ØªØ¬:" Style="{StaticResource HeaderTextStyle}"/>
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="36"/>
                        </Grid.ColumnDefinitions>
                        
                        <ComboBox x:Name="cmbProduct" 
                                  Grid.Column="0"
                                  Style="{StaticResource SmartComboBoxStyle}"
                                  DisplayMemberPath="ProductName"
                                  IsEditable="True"
                                  TabIndex="1"
                                  SelectionChanged="cmbProduct_SelectionChanged"
                                  PreviewTextInput="cmbProduct_PreviewTextInput"
                                  DropDownOpened="cmbProduct_DropDownOpened"
                                  KeyDown="cmbProduct_KeyDown"/>
                        
                        <Button Grid.Column="1" 
                                x:Name="btnSearchProduct"
                                Content="ðŸ”Ž" 
                                Width="32" Height="32" 
                                Margin="4,0,0,0"
                                Background="{DynamicResource AccentBrush}"
                                Foreground="White"
                                BorderThickness="0"
                                FontSize="12"
                                Cursor="Hand"
                                Click="btnSearchProduct_Click">
                            <Button.ToolTip>
                                <ToolTip Content="F1 - Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"/>
                            </Button.ToolTip>
                        </Button>
                    </Grid>

                    <!-- Ø§Ù„ÙˆØ­Ø¯Ø© + ØªØ­ÙˆÙŠÙ„ -->
                    <TextBlock Text="Ø§Ù„ÙˆØ­Ø¯Ø©:" Style="{StaticResource HeaderTextStyle}"/>
                    <ComboBox x:Name="cmbUnit" 
                              Style="{StaticResource SmartComboBoxStyle}"
                              ItemTemplate="{StaticResource UnitConversionTemplate}"
                              TabIndex="2"
                              SelectionChanged="cmbUnit_SelectionChanged"
                              Margin="0,0,0,12"/>

                    <!-- Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ© -->
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠØ© -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠØ©:" Style="{StaticResource HeaderTextStyle}"/>
                        <TextBox Grid.Row="1" Grid.Column="0" 
                                 x:Name="txtWholeQty"
                                 Style="{StaticResource NumericTextBoxStyle}"
                                 Text="1"
                                 TabIndex="3"
                                 TextChanged="txtWholeQty_TextChanged"/>

                        <!-- Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø²Ø¦ÙŠØ© -->
                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©:" Style="{StaticResource HeaderTextStyle}"/>
                        <TextBox Grid.Row="1" Grid.Column="2" 
                                 x:Name="txtPartQty"
                                 Style="{StaticResource NumericTextBoxStyle}"
                                 Text="0"
                                 TabIndex="4"
                                 TextChanged="txtPartQty_TextChanged"/>

                        <!-- Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ -->
                        <TextBlock Grid.Row="2" Grid.ColumnSpan="3" 
                                   Text="Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„:" 
                                   Style="{StaticResource HeaderTextStyle}" 
                                   Margin="0,8,0,0"/>
                        <Border Grid.Row="3" Grid.ColumnSpan="3" Style="{StaticResource InfoBadge}">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="1 ÙˆØ­Ø¯Ø© Ø£Ø³Ø§Ø³ÙŠØ© = " Foreground="White"/>
                                <TextBlock x:Name="lblConversionFactor" Text="1.00" FontWeight="Bold" Foreground="White"/>
                                <TextBlock Text=" Ù…Ù† Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©" Foreground="White"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø°ÙƒÙŠØ© -->
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ -->
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ:" Style="{StaticResource HeaderTextStyle}"/>
                        <TextBox Grid.Row="1" Grid.Column="0" 
                                 x:Name="txtWholePrice"
                                 Style="{StaticResource NumericTextBoxStyle}"
                                 Text="0.00"
                                 TabIndex="5"
                                 TextChanged="txtWholePrice_TextChanged"/>

                        <!-- Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¦ÙŠ -->
                        <TextBlock Grid.Row="0" Grid.Column="2" Text="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø²Ø¦ÙŠ:" Style="{StaticResource HeaderTextStyle}"/>
                        <TextBox Grid.Row="1" Grid.Column="2" 
                                 x:Name="txtPartPrice"
                                 Style="{StaticResource NumericTextBoxStyle}"
                                 Text="0.00"
                                 TabIndex="6"
                                 TextChanged="txtPartPrice_TextChanged"/>

                        <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
                        <Border Grid.Row="2" Grid.ColumnSpan="3" 
                                x:Name="brdAutoPriceIndicator"
                                Style="{StaticResource InfoBadge}" 
                                Margin="0,4,0,0"
                                Visibility="Collapsed">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="ðŸ”„" Margin="0,0,4,0" Foreground="White"/>
                                <TextBlock Text="ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù†:" Foreground="White"/>
                                <TextBlock x:Name="lblPriceSource" Text="Ø§Ù„Ù…Ù†ØªØ¬" FontWeight="Bold" Foreground="White" Margin="4,0,0,0"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Ø§Ù„Ø®ØµÙ… -->
                    <TextBlock Text="Ø§Ù„Ø®ØµÙ…:" Style="{StaticResource HeaderTextStyle}"/>
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBox Grid.Column="0" 
                                 x:Name="txtDiscount"
                                 Style="{StaticResource NumericTextBoxStyle}"
                                 Text="0.00"
                                 TabIndex="7"
                                 TextChanged="txtDiscount_TextChanged"/>
                        
                        <ComboBox Grid.Column="2" 
                                  x:Name="cmbDiscountType"
                                  Style="{StaticResource SmartComboBoxStyle}"
                                  SelectedIndex="0"
                                  SelectionChanged="cmbDiscountType_SelectionChanged">
                            <ComboBoxItem Content="Ø¬.Ù…"/>
                            <ComboBoxItem Content="%"/>
                        </ComboBox>
                    </Grid>
                </StackPanel>

                <!-- ÙØ§ØµÙ„ -->
                <Rectangle Grid.Column="1" 
                          Fill="{DynamicResource BorderBrush}" 
                          Width="1" 
                          HorizontalAlignment="Center" 
                          Margin="0,8"/>

                <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø±: Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø®Øµ -->
                <StackPanel Grid.Column="2">
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
                    <Border Background="{DynamicResource SurfaceBrush}" 
                            BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="1" 
                            CornerRadius="6" 
                            Padding="12" 
                            Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬" 
                                       Style="{StaticResource HeaderTextStyle}" 
                                       HorizontalAlignment="Center" 
                                       Margin="0,0,0,8"/>
                            
                            <TextBlock Text="Ø§Ù„Ø§Ø³Ù…:" FontWeight="Bold" Margin="0,0,0,2"/>
                            <TextBlock x:Name="lblProductName" Text="-" TextWrapping="Wrap" Margin="0,0,0,6"/>
                            
                            <TextBlock Text="Ø§Ù„ÙƒÙˆØ¯:" FontWeight="Bold" Margin="0,0,0,2"/>
                            <TextBlock x:Name="lblProductCode" Text="-" Margin="0,0,0,6"/>
                            
                            <TextBlock Text="Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ:" FontWeight="Bold" Margin="0,0,0,2"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock x:Name="lblCurrentStock" Text="0.00" Margin="0,0,4,0"/>
                                <TextBlock x:Name="lblStockUnit" Text="ÙˆØ­Ø¯Ø©" Foreground="{DynamicResource MutedBrush}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Ø¢Ø®Ø± 3 Ø£Ø³Ø¹Ø§Ø± -->
                    <Border x:Name="brdLastPrices"
                            Background="{DynamicResource SurfaceBrush}" 
                            BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="1" 
                            CornerRadius="6" 
                            Padding="12" 
                            Margin="0,0,0,12"
                            Visibility="Collapsed">
                        <StackPanel>
                            <TextBlock Text="Ø¢Ø®Ø± 3 Ø£Ø³Ø¹Ø§Ø±" 
                                       Style="{StaticResource HeaderTextStyle}" 
                                       HorizontalAlignment="Center" 
                                       Margin="0,0,0,8"/>
                            
                            <ItemsControl x:Name="icLastPrices">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{DynamicResource InfoBrush}" 
                                                CornerRadius="4" 
                                                Padding="6,3" 
                                                Margin="0,1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Price}" FontWeight="Bold" Foreground="White"/>
                                                <TextBlock Text=" Ø¬.Ù… ÙÙŠ " Foreground="White" Margin="4,0"/>
                                                <TextBlock Text="{Binding Date}" Foreground="White"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- ØªØ­Ø°ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
                    <Border x:Name="brdStockWarning" 
                            Style="{StaticResource StockWarningStyle}"
                            Margin="0,0,0,12"
                            Visibility="Collapsed">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="âš ï¸" Margin="0,0,4,0" Foreground="White"/>
                            <TextBlock x:Name="lblStockWarning" Text="ØªØ­Ø°ÙŠØ± Ù…Ø®Ø²ÙˆÙ†" Foreground="White" FontWeight="Bold"/>
                        </StackPanel>
                    </Border>

                    <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
                    <Border Background="{DynamicResource SuccessBrush}" 
                            CornerRadius="8" 
                            Padding="16" 
                            Margin="0,0,0,12">
                        <StackPanel>
                            <TextBlock Text="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø·Ø±" 
                                       FontSize="{DynamicResource FontSizeNormal}" 
                                       FontWeight="Bold" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center" 
                                       Margin="0,0,0,8"/>
                            
                            <TextBlock x:Name="lblLineTotal" 
                                       Text="0.00 Ø¬.Ù…" 
                                       FontSize="{DynamicResource FontSizeLarge}" 
                                       FontWeight="Bold" 
                                       Foreground="White" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø­Ø§Ù„Ø© -->
                    <Border x:Name="brdStatusIndicator"
                            Background="{DynamicResource InfoBrush}" 
                            CornerRadius="6" 
                            Padding="8">
                        <TextBlock x:Name="lblStatusMessage" 
                                   Text="Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø¯Ø®Ø§Ù„" 
                                   Foreground="White" 
                                   FontWeight="Bold" 
                                   HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- ========== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ========== -->
        <Border Grid.Row="2" 
                Background="{DynamicResource SurfaceBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="0,1,0,0" 
                Padding="16,12" 
                Margin="0,8,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button x:Name="btnPrevious" 
                            Content="â—€ Ø§Ù„Ø³Ø§Ø¨Ù‚" 
                            Style="{DynamicResource SecondaryButtonStyle}" 
                            IsTabStop="False"
                            Click="btnPrevious_Click"
                            Margin="0,0,8,0">
                        <Button.ToolTip>
                            <ToolTip Content="F5 - Ø§Ù„ØµÙ†Ù Ø§Ù„Ø³Ø§Ø¨Ù‚"/>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button x:Name="btnNext" 
                            Content="Ø§Ù„ØªØ§Ù„ÙŠ â–¶" 
                            Style="{DynamicResource SecondaryButtonStyle}" 
                            IsTabStop="False"
                            Click="btnNext_Click">
                        <Button.ToolTip>
                            <ToolTip Content="F6 - Ø§Ù„ØµÙ†Ù Ø§Ù„ØªØ§Ù„ÙŠ"/>
                        </Button.ToolTip>
                    </Button>
                </StackPanel>

                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Center" 
                            VerticalAlignment="Center">
                    <TextBlock Text="Enter Ù„Ù„Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ù„ÙŠ" Style="{StaticResource QuickHint}"/>
                    <TextBlock Text="â€¢" Style="{StaticResource QuickHint}"/>
                    <TextBlock Text="F1 Ø¨Ø­Ø«" Style="{StaticResource QuickHint}"/>
                    <TextBlock Text="â€¢" Style="{StaticResource QuickHint}"/>
                    <TextBlock Text="Ctrl+S Ø­ÙØ¸ ÙˆØ¥Ø¶Ø§ÙØ©" Style="{StaticResource QuickHint}"/>
                </StackPanel>

                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø¥Ù„ØºØ§Ø¡ -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button x:Name="btnSaveAndAdd" 
                            Content="âœ… Ø­ÙØ¸ ÙˆØ¥Ø¶Ø§ÙØ©" 
                            Style="{DynamicResource PrimaryButtonStyle}" 
                            TabIndex="8"
                            Click="btnSaveAndAdd_Click" 
                            Margin="0,0,8,0">
                        <Button.ToolTip>
                            <ToolTip Content="Ctrl+S - Ø­ÙØ¸ Ø§Ù„Ø³Ø·Ø± ÙˆÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©"/>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button x:Name="btnSaveAndClose" 
                            Content="âœ… Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚" 
                            Style="{DynamicResource SecondaryButtonStyle}" 
                            TabIndex="9"
                            Click="btnSaveAndClose_Click" 
                            Margin="0,0,8,0">
                        <Button.ToolTip>
                            <ToolTip Content="Ctrl+Shift+S - Ø­ÙØ¸ Ø§Ù„Ø³Ø·Ø± ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©"/>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button x:Name="btnCancel" 
                            Content="âœ— Ø¥Ù„ØºØ§Ø¡" 
                            Style="{DynamicResource DangerButtonStyle}" 
                            TabIndex="10"
                            Click="btnCancel_Click">
                        <Button.ToolTip>
                            <ToolTip Content="Escape - Ø¥Ù„ØºØ§Ø¡ ÙˆØ¥ØºÙ„Ø§Ù‚"/>
                        </Button.ToolTip>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ========== Ø·Ø¨Ù‚Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ========== -->
        <Grid x:Name="BusyOverlay" 
              Grid.RowSpan="3"
              Visibility="Collapsed" 
              Background="#80000000">
            <Border Background="{DynamicResource SurfaceBrush}" 
                    BorderBrush="{DynamicResource BorderBrush}" 
                    BorderThickness="1" 
                    Padding="24" 
                    CornerRadius="8" 
                    Width="280" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©..." 
                               FontWeight="Bold" 
                               HorizontalAlignment="Center" 
                               Margin="0,0,0,12"/>
                    <ProgressBar IsIndeterminate="True" Height="6"/>
                    <TextBlock x:Name="lblLoadingMessage" 
                               Text="ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..." 
                               FontSize="11" 
                               Foreground="{DynamicResource MutedBrush}" 
                               HorizontalAlignment="Center" 
                               Margin="0,8,0,0"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>