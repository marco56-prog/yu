<Window x:Class="AccountingSystem.WPF.Views.StockMovementsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="حركات المخزن" 
        Height="650" Width="1100" 
        WindowStartupLocation="CenterScreen"
        FlowDirection="RightToLeft"
        FontFamily="Segoe UI, Tahoma"
        FontSize="14">
    
    <Window.Resources>
        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#2E8B57"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- العنوان -->
        <TextBlock Grid.Row="0" Text="حركات المخزن" 
                   FontSize="20" FontWeight="Bold" 
                   HorizontalAlignment="Center" 
                   Margin="0,10"/>

        <!-- فلاتر البحث -->
        <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" 
                CornerRadius="5" Margin="10" Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- المنتج -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="5">
                    <TextBlock Text="المنتج:" FontWeight="Bold"/>
                    <ComboBox Name="cmbProductFilter" DisplayMemberPath="ProductName" 
                              SelectedValuePath="ProductId" SelectionChanged="Filter_Changed"/>
                </StackPanel>

                <!-- نوع الحركة -->
                <StackPanel Grid.Row="0" Grid.Column="1" Margin="5">
                    <TextBlock Text="نوع الحركة:" FontWeight="Bold"/>
                    <ComboBox Name="cmbMovementType" SelectionChanged="Filter_Changed">
                        <ComboBoxItem Content="جميع الحركات" Tag=""/>
                        <ComboBoxItem Content="دخول" Tag="In"/>
                        <ComboBoxItem Content="خروج" Tag="Out"/>
                        <ComboBoxItem Content="تسوية" Tag="Adjustment"/>
                    </ComboBox>
                </StackPanel>

                <!-- من تاريخ -->
                <StackPanel Grid.Row="0" Grid.Column="2" Margin="5">
                    <TextBlock Text="من تاريخ:" FontWeight="Bold"/>
                    <DatePicker Name="dpFromDate" SelectedDateChanged="Filter_Changed"/>
                </StackPanel>

                <!-- إلى تاريخ -->
                <StackPanel Grid.Row="0" Grid.Column="3" Margin="5">
                    <TextBlock Text="إلى تاريخ:" FontWeight="Bold"/>
                    <DatePicker Name="dpToDate" SelectedDateChanged="Filter_Changed"/>
                </StackPanel>

                <!-- أزرار التحكم -->
                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4" 
                            Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                    <Button Name="btnRefresh" Content="تحديث" 
                            Style="{StaticResource ButtonStyle}" Click="btnRefresh_Click"/>
                    <Button Name="btnClearFilter" Content="مسح الفلتر" 
                            Style="{StaticResource ButtonStyle}" Click="btnClearFilter_Click"/>
                    <Button Name="btnExport" Content="تصدير إلى Excel" 
                            Style="{StaticResource ButtonStyle}" Click="btnExport_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- جدول حركات المخزن -->
        <DataGrid Grid.Row="2" Name="dgStockMovements" 
                  AutoGenerateColumns="False" 
                  CanUserAddRows="False"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  SelectionMode="Single"
                  Margin="10">
            <DataGrid.Columns>
                <DataGridTextColumn Header="التاريخ" Binding="{Binding MovementDate, StringFormat=yyyy-MM-dd HH:mm}" Width="140" IsReadOnly="True"/>
                <DataGridTextColumn Header="المنتج" Binding="{Binding Product.ProductName}" Width="200" IsReadOnly="True"/>
                <DataGridTextColumn Header="نوع الحركة" Binding="{Binding MovementType}" Width="100" IsReadOnly="True"/>
                <DataGridTextColumn Header="الكمية" Binding="{Binding Quantity, StringFormat=N2}" Width="100" IsReadOnly="True"/>
                <DataGridTextColumn Header="الوحدة" Binding="{Binding Unit.UnitName}" Width="80" IsReadOnly="True"/>
                <DataGridTextColumn Header="الكمية بالوحدة الأساسية" Binding="{Binding QuantityInMainUnit, StringFormat=N2}" Width="150" IsReadOnly="True"/>
                <DataGridTextColumn Header="نوع المرجع" Binding="{Binding ReferenceType}" Width="120" IsReadOnly="True"/>
                <DataGridTextColumn Header="رقم المرجع" Binding="{Binding ReferenceId}" Width="100" IsReadOnly="True"/>
                <DataGridTextColumn Header="ملاحظات" Binding="{Binding Notes}" Width="*" IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- شريط الحالة -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Name="lblStatus" Text="جاهز"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Name="lblCount" Text="عدد الحركات: 0"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
